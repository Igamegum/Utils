---
title: "C++编程规范"
tags: [C++]
---

上了半年的班，越来越发现一些项目的代码不好维护，尤其时接手别人的代码的时候，那叫一个难受，越发觉得需要一套良好的代码规范。抽空阅读了 [Google C++ 编程规范](https://github.com/Igamegum/Utils/blob/master/Google_Cpp_Style_guide_CN.pdf)，整理一下并做个笔记，以后的编码一定要规范化。
<!--more-->


## 头文件

1.  每个头文件一定要用 **#define** 语句防止被重复包含，命名规则 *&lt;Project&gt;_&lt;Path&gt;_&lt;File&gt;_H_*
2.  尽量使用前置声明代替 *.h* 被包含的次数，因为当 *.h* 修改后，其他包含它的文件也需要重新编译
3.  逻辑简单，代码量不超过10行的函数才考虑声明为内联函数，析构函数和递归函数声明为内联的时候应该慎重分析
4. 复杂的内联函数的定义最好放到*inl.h* 文件中
5. 声明函数时，输入参数在前，输出参数在后
6. 在代码中包含*.h*的时候，为了避免隐藏的依赖，次序如下 *C库*，*C++库*，*其他依赖库.h*，*本项目库.h*，

## 作用域

1.  **不要使用 using namespace std ;** 等语句，这样会造成命名空间污染，有时候会导致奇怪的编译错误
2.  不要将嵌套类定义为public，除非它们时接口的一部分
3. 使用命名空间中的非成员函数或者静态成员函数，尽量不要使用全局函数
4. 局部变量尽可能声明在离第一次使用最近的地方，并且声明的时候就初始化，但如果局部变量是对象，则要避免其多次构造和析构
5. 禁止使用class类型的全局变量（包括 STL的std::string,std::vector等），因为它们的初始化顺序可能导致构造出现问题

## 类

1. 构造函数只进行没有实际意义的初始化，有实际意义的初始化统一放到**Init**函数中执行
2. 如果一个类定义了成员变量，又没有其他构造函数，请提供一个默认的构造函数
3. 对于单参数的构造函数，可考虑使用**explicit**关键字 避免意想不到的类型转换
4. 代码中不需要拷贝对象的时候，应使用**DISALOW_COPY_AND_ASSIGN**
5. 仅当只有数据时，使用**struct**,其他时候使用**class**
6. 尽量使用组合代替继承，继承只使用公有继承
7. <del>多重继承<del/>
8. <del>接口<del/>
9. 一般不要重载操作符
10. 将数据成员私有化，并提供相关的get set函数
11. 类中的声明次序如下，public、protected、private;成员函数在数据成员前面
12. 编写短小的函数，函数长度尽量不要超过40行

## Google特有风情

使用智能指针的时候，一般情况下*scoped_ptr*完全可以胜任，任何情况下都不要使用*auto_ptr*

## 其他C++特性

1. 在函数形参表中，所有引用必须为**const**，如果需要修改形参的值，使用指针
2. 不实用重载函数来模仿缺省函数
3. 禁止使用缺省的函数参数
4. 尽量使用 *sizeof(varname)*代替*sizeof(type)*
5. 禁止使用变长数据和alloca
6. 允许合理使用友元类和友元函数
7. 不要使用C++异常
8. 禁止使用 **RTTI**
9. 使用**static_cast<>()**等C++提供的类型转换，禁止使用 C 风格的类型转换
10. 只有在记录日志的时候使用流，其余使用**printf()**等代替
11. 将自增和自减前置
12. 能使用**const**的情况下尽可能加上**const**修饰
13. 如果程序中要使用不同大小的*int*，可以使用*<stdint.h>*中的类型，因为*int*在不同编译环境下的精确宽度会不一致
14. 64位系统下的可移植特性
      *  printf()指定的一些类型在32和64位上的可移植性能不是很好
      *  如果需要一个指针大小的整数，要用**intptr_t**类型
      *  需要对结构体在系统上的内存对齐留心
      *  创建64位常量时，用*LL*或者*ULL*作为后缀


15. 预处理宏尽量使用内联函数、枚举和常量代替
16. 整数用 *0*， 实数用 *0.0* ，字符用 *'\0'* ，指针用*nullptr*
17. 只使用Boost中被认可的库

## 命名约定

1. 使用描述性明确的变量名
2. 文件名全部小写，可接下划线(_)或者断线(-)
3. 所有自定义类型的命名以大写字母开头，并且不加下划线(_)或者断线(-)
4. 普通变量名全部小写，单词之间接下划线(_)或者断线(-)，对于全局变量接加*g_*类似的前缀作为区分
5. 常量的命名在名称前加小写字母*k*
6. 普通函数的命名大小写混合，存取函数则要求与变量名字匹配
7. 命名空间的名称全是小写，命名基于项目名称和目录结构
8. 枚举命名应该全部大写，并且单词之间以下划线相连
9. 宏命名与与枚举命名一样
10. 当命名与现有的C++实体相似的对象时，可以参考现有的命名

## 注释 

1. 注释风格要统一
2. 每个文件应该在开头加上版权，许可版权，作者等信息
3. 类的定义要附加类的功能和用法的注释
4. 函数声明处描述函数的功能，定义处描述实现
5. 变量的用途添加描述
6. 实现中巧妙、晦涩等地方要加以注释
7. 留意标点、拼写和语法
8. 对于临时和短期的方案要加上TODO注释

## 格式

1. 每一行代码的字符数不超过80
2. 尽量不使用非**ASCII**字符，使用时必须使用**UTF-8**格式
3. 只使用空格，每次缩进两个空格
4. 函数的声明和定义遵循如下规则
    * 返回值总是和函数名在同一行
    * 左圆括号和函数名在同一行
    * 左圆括号和函数名之间没有空格
    * 圆括号与参数间没有空格
    * 右园括号和左大括号之间总是有一个空格
    * 左大括号总在最后一个参数同一行的末尾处
    * 右大括号总是单独位于函数最后一行
    * 函数声明和实现处的所有形参的名称必须保持一致
    * 所有形参应尽可能对齐
    * 缺省缩进为两个空格
    * 独立封装的参数保持4个空格的缩进

5. 函数的调用尽量放在同一行
6. 条件语句风格要统一，关键字else另起一行
7. switch语句使用大括号分块，空循环体使用{}或者continue
8. 句点(.)和箭头(→ )前后不要有空格
9. bool表达式断行要统一
10. 函数返回值的表达式不要使用圆括号
11. 变量及数组的初始化风格要统一
12.  预处理指令不要缩进，从行首开始
13.  类的缩进格式每次1个空格
14. 构造函数初始化列表放在同一行或者按照4个空格缩进
15. 命名空间内容不缩进
16. 水平留白要恰当
17. 垂直留白要尽可能少

## 结尾

大概就是以上的内容，上面并没有提到文件目录的存放结构以及分离式编译的使用，然而工程稍大之后，这些都是非常必要的，不过这些应该都属于工程组织上的内容了，所以还是好好学习怎么写 *cmake* 吧，不能贪图方便，一条 *g++* 命令就写到底了。



    

 



        
    








